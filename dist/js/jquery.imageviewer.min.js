!function(a){var t={interfaceTop:!0,interfaceNav:!0,keyboardNav:!0,loadAtStart:2};a.fn.imageViewer=function(){if(0===a(this).length)return a(this);var e={},i=a(this);e.settings=a.extend({},t),e.images=i.children(".image"),e.firstImage=e.images.slice(0,1),e.numImages=e.images.length,e.currentImage=i.children(".active");var s=function(){e.settings.interfaceTop&&n("top"),e.settings.interfaceNav&&n("nav"),h(e.firstImage,!0),r(e.firstImage),e.settings.loadAtStart>2&&(e.settings.loadAtStart>e.numImages&&(e.settings.loadAtStart=e.numImages),h(e.images.slice(2,e.settings.loadAtStart),!1)),a(".image").bind("click",function(t){t.preventDefault(),o(a(this))}),a(".nav-item").bind("click",function(t){t.preventDefault(),r(a(this).hasClass("next")?c():l())}),e.settings.keyboardNav&&a(document).keydown(function(a){37==a.keyCode?r(l()):39==a.keyCode&&r(c())}),a(window).resize(function(){var a=i.width(),t=i.height();g(i.find(".active"),a,t)})},n=function(a){"top"==a&&i.before('<section id="top" class="interface"><ul class="details"><li class="image-title"><span class="value"></span><li class="image-src"><span class="label">Filename:</span> <span class="value"></span><li class="image-width"><span class="label">Width:</span> <span class="value"></span><li class="image-height"><span class="label">Height:</span> <span class="value"></span><li class="image-scale"><span class="label">Scale:</span> <span class="value"></span></ul></section>'),"nav"==a&&i.before('<section id="nav" class="interface"><a href="#" class="nav-item prev">Previous</a><a href="#" class="nav-item next">Next</a></section>')},r=function(t){e.images.removeClass("active"),t.addClass("active"),a(window).trigger("resize"),h(c()),h(l())},c=function(){var t=a(".active").index();return t==e.numImages-1?a(".image").first():a(".active").next()},l=function(){var t=a(".active").index();return 0===t?a(".image").last():a(".active").prev()},g=function(t,e,i){var s={title:t.attr("data-title"),src:t.attr("data-src").replace(/^.*[\\\/]/,""),width:t.attr("data-orig-width"),height:t.attr("data-orig-height"),scale:d(t,e,i)};a(".image-title .value").text(s.title),a(".image-src .value").text(s.src),a(".image-width .value").text(s.width),a(".image-height .value").text(s.height),a(".image-scale .value").text(s.scale)},d=function(a,t,e){var i,s=t,n=e,r=a.attr("data-orig-width"),c=a.attr("data-orig-height"),l=s/n,g=r/c;return i=1>g?l>g?n/c:s/r:g>l?s/r:n/c,Math.round(100*i)+"%"},o=function(t){var e=t.attr("data-orig-width"),i=t.attr("data-orig-height");t.hasClass("original")?(t.removeClass("original"),t.css("width","100%"),t.css("height","100%"),a(".interface").removeClass("hidden")):(t.addClass("original"),t.css("width",e+"px"),t.css("height",i+"px"),a(".interface").addClass("hidden"))},h=function(t,e){t.each(function(){var t=a(this),i=new Image;i.src=t.attr("data-src"),i.onload=function(){var s=i.width,n=i.height;t.attr("data-orig-width",s),t.attr("data-orig-height",n),t.css("background-image","url("+i.src+")"),t.addClass("loaded"),e&&a(window).trigger("resize")}})};return i.each(function(){s()})}}(jQuery);